<!--pages/profile/notifications/index.wxml-->
<view class="container">
  <!-- 导航栏 -->
  <view class="nav-bar">
    <view class="nav-back" bindtap="goBack">
      <text class="nav-icon">‹</text>
      <text class="nav-text">返回</text>
    </view>
    <text class="nav-title">消息通知</text>
    <view class="nav-placeholder"></view>
  </view>

  <!-- 标题栏 -->
  <view class="header">
    <view class="title">消息通知</view>
    <view class="subtitle">查看和管理您的通知</view>
  </view>

  <!-- 过滤选项 -->
  <view class="filter-tabs">
    <view 
      class="filter-tab {{filterType === 'all' ? 'active' : ''}}"
      data-type="all"
      bindtap="filterNotifications"
    >
      全部
    </view>
    <view 
      class="filter-tab {{filterType === 'unread' ? 'active' : ''}}"
      data-type="unread"
      bindtap="filterNotifications"
    >
      未读
      <view wx:if="{{getUnreadCount() > 0}}" class="unread-badge">{{getUnreadCount()}}</view>
    </view>
    <view 
      class="filter-tab {{filterType === 'system' ? 'active' : ''}}"
      data-type="system"
      bindtap="filterNotifications"
    >
      系统
    </view>
    <view 
      class="filter-tab {{filterType === 'template' ? 'active' : ''}}"
      data-type="template"
      bindtap="filterNotifications"
    >
      模板
    </view>
    <view 
      class="filter-tab {{filterType === 'security' ? 'active' : ''}}"
      data-type="security"
      bindtap="filterNotifications"
    >
      安全
    </view>
  </view>

  <!-- 操作按钮 -->
  <view class="action-bar">
    <button class="action-btn" bindtap="markAllAsRead">全部已读</button>
    <button class="action-btn clear-btn" bindtap="clearAllNotifications">清空</button>
  </view>

  <!-- 通知列表 -->
  <view class="notifications-list">
    <view wx:if="{{notifications.length === 0}}" class="empty-state">
      <view class="empty-icon">📭</view>
      <view class="empty-text">暂无通知</view>
      <view class="empty-desc">当有新消息时，会在这里显示</view>
    </view>

    <view wx:else class="notification-items">
      <view 
        class="notification-item {{item.read ? '' : 'unread'}} {{item.important ? 'important' : ''}}"
        wx:for="{{notifications}}"
        wx:key="id"
        data-id="{{item.id}}"
        bindtap="viewNotificationDetail"
      >
        <view class="notification-header">
          <view class="notification-type {{item.type}}">{{getTypeText(item.type)}}</view>
          <view class="notification-time">{{item.time}}</view>
        </view>
        
        <view class="notification-content">
          <view class="notification-title">{{item.title}}</view>
          <view class="notification-body">{{item.content}}</view>
        </view>

        <view class="notification-actions">
          <button 
            wx:if="{{!item.read}}"
            class="action-btn read-btn" 
            data-id="{{item.id}}"
            bindtap="markAsRead"
            catchtap="stopPropagation"
          >
            标记已读
          </button>
          <button 
            class="action-btn delete-btn" 
            data-id="{{item.id}}"
            bindtap="deleteNotification"
            catchtap="stopPropagation"
          >
            删除
          </button>
        </view>

        <!-- 未读标记 -->
        <view wx:if="{{!item.read}}" class="unread-indicator"></view>
        <!-- 重要标记 -->
        <view wx:if="{{item.important}}" class="important-indicator">!</view>
      </view>
    </view>
  </view>

  <!-- 加载更多 -->
  <view wx:if="{{hasMore && !isLoading}}" class="load-more">
    <button class="load-more-btn" bindtap="loadMoreNotifications">加载更多</button>
  </view>

  <!-- 加载状态 -->
  <view wx:if="{{isLoading}}" class="loading-mask">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text>加载中...</text>
    </view>
  </view>
</view>