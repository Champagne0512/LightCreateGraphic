<view class="container">
  <!-- å¤´éƒ¨ï¼šç”¨æˆ·ä¿¡æ¯ -->
  <view class="profile-header">
    <view class="user-info">
      <view class="user-avatar" bindtap="uploadAvatar">
        <image wx:if="{{profile.avatar_url}}" class="avatar-img" src="{{profile.avatar_url}}" mode="aspectFill" />
        <text wx:else>ğŸ‘¤</text>
        <view class="avatar-overlay">æ›´æ¢å¤´åƒ</view>
      </view>
      <view class="user-details">
        <view class="user-name">{{profile.nickname || profile.name || 'æœªå‘½åç”¨æˆ·'}}</view>
        <view class="user-id">IDï¼š{{profile.id ? profile.id.slice(0,8) : '--'}} Â· {{profile.phone || 'æœªç»‘å®š'}}</view>
        <view class="user-status">
          <text class="status-badge {{profile.member_status ? 'member' : 'free'}}">
            {{profile.member_status ? 'ä¼šå‘˜' : 'å…è´¹ç”¨æˆ·'}}
          </text>
          <text class="security-level">å®‰å…¨ç­‰çº§ï¼š{{profile.security_level}}</text>
        </view>
      </view>
      <button class="edit-btn" size="mini" bindtap="toggleEdit">{{editing ? 'å–æ¶ˆ' : 'ç¼–è¾‘'}}</button>
    </view>
    
    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-num">{{stats.works}}</text>
        <text class="stat-label">ä½œå“</text>
      </view>
      <view class="stat-item">
        <text class="stat-num">{{stats.favorites}}</text>
        <text class="stat-label">æ”¶è—</text>
      </view>
      <view class="stat-item">
        <text class="stat-num">{{stats.drafts}}</text>
        <text class="stat-label">è‰ç¨¿</text>
      </view>
      <view class="stat-item">
        <text class="stat-num">{{stats.templates}}</text>
        <text class="stat-label">æ¨¡æ¿</text>
      </view>
      <view class="stat-item">
        <text class="stat-num">{{stats.downloads}}</text>
        <text class="stat-label">ä¸‹è½½</text>
      </view>
      <view class="stat-item">
        <text class="stat-num">{{stats.views}}</text>
        <text class="stat-label">æµè§ˆ</text>
      </view>
    </view>
  </view>

  <!-- å¯¼èˆªæ ‡ç­¾ -->
  <view class="tab-container">
    <view class="tab-item {{activeTab === 'profile' ? 'active' : ''}}" data-tab="profile" bindtap="switchTab">
      <text>ä¸ªäººèµ„æ–™</text>
    </view>
    <view class="tab-item {{activeTab === 'notifications' ? 'active' : ''}}" data-tab="notifications" bindtap="switchTab">
      <text>æ¶ˆæ¯é€šçŸ¥</text>
      <view wx:if="{{unreadCount > 0}}" class="badge">{{unreadCount}}</view>
    </view>
    <view class="tab-item {{activeTab === 'settings' ? 'active' : ''}}" data-tab="settings" bindtap="switchTab">
      <text>è®¾ç½®</text>
    </view>
  </view>

  <!-- ä¸ªäººèµ„æ–™æ ‡ç­¾é¡µ -->
  <view wx:if="{{activeTab === 'profile'}}" class="tab-content">
    <!-- ç¼–è¾‘èµ„æ–™ -->
    <view wx:if="{{editing}}" class="content-section">
      <view class="card">
        <view class="section-title">å®Œå–„èµ„æ–™</view>
        <view class="form-item">
          <text class="form-label">å§“å</text>
          <input class="form-input" placeholder="è¯·è¾“å…¥å§“å" value="{{profile.name}}" bindinput="onNameInput" />
        </view>
        <view class="form-item">
          <text class="form-label">æ˜µç§°</text>
          <input class="form-input" placeholder="è¯·è¾“å…¥æ˜µç§°" value="{{profile.nickname}}" bindinput="onNicknameInput" />
        </view>
        <view class="form-item">
          <text class="form-label">ç­¾å</text>
          <input class="form-input" placeholder="è¿™ä¸ªäººå¾ˆæ‡’ï¼Œè¿˜æ²¡æœ‰ç­¾å" value="{{profile.bio}}" bindinput="onBioInput" />
        </view>
        <view class="form-item">
          <text class="form-label">åŸå¸‚</text>
          <input class="form-input" placeholder="åŸå¸‚/åœ°åŒº" value="{{profile.location}}" bindinput="onLocationInput" />
        </view>
        <view class="form-item">
          <text class="form-label">ç½‘ç«™</text>
          <input class="form-input" placeholder="https://example.com" value="{{profile.website}}" bindinput="onWebsiteInput" />
        </view>
        <button class="primary-btn" loading="{{isLoading}}" bindtap="saveProfile">ä¿å­˜èµ„æ–™</button>
      </view>
    </view>

    <!-- åŠŸèƒ½å¡ç‰‡ -->
    <view class="content-section">
      <!-- å®‰å…¨è®¾ç½® -->
      <view class="card" bindtap="navigateToSecurity">
        <view class="section-title">è´¦æˆ·å®‰å…¨</view>
        <view class="feature-list">
          <view class="feature-item">
            <text class="feature-icon">ğŸ”’</text>
            <view class="feature-info">
              <text class="feature-title">å¯†ç ä¿®æ”¹</text>
              <text class="feature-desc">å®šæœŸæ›´æ–°å¯†ç ä¿æŠ¤è´¦æˆ·å®‰å…¨</text>
            </view>
            <text class="feature-arrow">â€º</text>
          </view>
          <view class="feature-item">
            <text class="feature-icon">ğŸ”</text>
            <view class="feature-info">
              <text class="feature-title">åŒé‡éªŒè¯</text>
              <text class="feature-desc">å¼€å¯åéœ€è¦éªŒè¯ç ç™»å½•</text>
            </view>
            <text class="feature-arrow">â€º</text>
          </view>
        </view>
      </view>

      <!-- éšç§è®¾ç½® -->
      <view class="card" bindtap="navigateToPrivacy">
        <view class="section-title">éšç§è®¾ç½®</view>
        <view class="setting-item">
          <text class="setting-label">å…¬å¼€ä¸ªäººèµ„æ–™</text>
          <switch checked="{{profile.privacy_settings.profile_visible}}" data-setting="profile_visible" bindchange="togglePrivacySetting" />
        </view>
        <view class="setting-item">
          <text class="setting-label">å…¬å¼€ä½œå“</text>
          <switch checked="{{profile.privacy_settings.works_visible}}" data-setting="works_visible" bindchange="togglePrivacySetting" />
        </view>
        <view class="setting-item">
          <text class="setting-label">æ˜¾ç¤ºåœ¨çº¿çŠ¶æ€</text>
          <switch checked="{{profile.privacy_settings.show_online_status}}" data-setting="show_online_status" bindchange="togglePrivacySetting" />
        </view>
        <button class="secondary-btn" bindtap="savePrivacySettings">ä¿å­˜è®¾ç½®</button>
      </view>

      <!-- æ•°æ®ç»Ÿè®¡ -->
      <view class="card" bindtap="navigateToStatistics">
        <view class="section-title">æ•°æ®ç»Ÿè®¡</view>
        <view class="stats-detail">
          <view class="stat-detail-item">
            <text class="detail-label">ä¼šå‘˜å¤©æ•°</text>
            <text class="detail-value">{{stats.memberDays}} å¤©</text>
          </view>
          <view class="stat-detail-item">
            <text class="detail-label">æ¨¡æ¿ä½¿ç”¨</text>
            <text class="detail-value">{{stats.templates}} æ¬¡</text>
          </view>
          <view class="stat-detail-item">
            <text class="detail-label">ä½œå“ä¸‹è½½</text>
            <text class="detail-value">{{stats.downloads}} æ¬¡</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ¶ˆæ¯é€šçŸ¥æ ‡ç­¾é¡µ -->
  <view wx:if="{{activeTab === 'notifications'}}" class="tab-content">
    <view class="content-section">
      <view class="card">
        <view class="section-title">æ¶ˆæ¯é€šçŸ¥ ({{unreadCount}} æ¡æœªè¯»)</view>
        <block wx:if="{{notifications.length}}">
          <block wx:for="{{notifications}}" wx:key="id">
            <view class="notification-item {{item.read ? '' : 'unread'}}">
              <view class="notification-icon">
                <text wx:if="{{item.type === 'system'}}">ğŸ””</text>
                <text wx:if="{{item.type === 'template'}}">ğŸ“‹</text>
                <text wx:if="{{item.type === 'security'}}">ğŸ”’</text>
              </view>
              <view class="notification-content">
                <view class="notification-title">{{item.title}}</view>
                <view class="notification-text">{{item.content}}</view>
                <view class="notification-time">{{item.time}}</view>
              </view>
              <view class="notification-actions">
                <text wx:if="{{!item.read}}" class="action-btn" data-id="{{item.id}}" bindtap="markNotificationAsRead">æ ‡è®°å·²è¯»</text>
                <text class="action-btn delete" data-id="{{item.id}}" bindtap="deleteNotification">åˆ é™¤</text>
              </view>
            </view>
          </block>
        </block>
        <view wx:else class="empty-state">
          <text class="empty-icon">ğŸ“­</text>
          <text class="empty-text">æš‚æ— é€šçŸ¥æ¶ˆæ¯</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è®¾ç½®æ ‡ç­¾é¡µ -->
  <view wx:if="{{activeTab === 'settings'}}" class="tab-content">
    <view class="content-section">
      <!-- ç³»ç»Ÿè®¾ç½® -->
      <view class="card">
        <view class="section-title">ç³»ç»Ÿè®¾ç½®</view>
        <view class="setting-item">
          <text class="setting-label">æ¨é€é€šçŸ¥</text>
          <switch checked="{{true}}" />
        </view>
        <view class="setting-item">
          <text class="setting-label">è‡ªåŠ¨ä¿å­˜è‰ç¨¿</text>
          <switch checked="{{true}}" />
        </view>
        <view class="setting-item">
          <text class="setting-label">é«˜æ¸…å›¾ç‰‡å¯¼å‡º</text>
          <switch checked="{{false}}" />
        </view>
      </view>

      <!-- å¸®åŠ©ä¸æ”¯æŒ -->
      <view class="card">
        <view class="section-title">å¸®åŠ©ä¸æ”¯æŒ</view>
        <view class="help-item">
          <text class="help-icon">â“</text>
          <text class="help-text">ä½¿ç”¨å¸®åŠ©</text>
          <text class="help-arrow">â€º</text>
        </view>
        <view class="help-item">
          <text class="help-icon">ğŸ“</text>
          <text class="help-text">è”ç³»å®¢æœ</text>
          <text class="help-arrow">â€º</text>
        </view>
        <view class="help-item">
          <text class="help-icon">ğŸ“</text>
          <text class="help-text">æ„è§åé¦ˆ</text>
          <text class="help-arrow">â€º</text>
        </view>
      </view>

      <!-- å…³äº -->
      <view class="card">
        <view class="section-title">å…³äº</view>
        <view class="about-item">
          <text class="about-label">ç‰ˆæœ¬</text>
          <text class="about-value">v1.0.0</text>
        </view>
        <view class="about-item">
          <text class="about-label">æ›´æ–°æ—¥æœŸ</text>
          <text class="about-value">2024-11-17</text>
        </view>
        <view class="about-item">
          <text class="about-label">å¼€å‘è€…</text>
          <text class="about-value">LightCreateGraphic Team</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è‰ç¨¿ä¸äº‘ç«¯ä½œå“ -->
  <view class="content-section">
    <view class="card">
      <view class="section-title">æˆ‘çš„è‰ç¨¿</view>
      <block wx:if="{{drafts.length}}">
        <block wx:for="{{drafts}}" wx:key="id">
          <view class="draft-item" bindtap="openDraft" data-id="{{item.id}}">
            <view class="draft-info">
              <text class="draft-name">{{item.id}}</text>
              <text class="draft-size">{{item.size.w}}x{{item.size.h}}</text>
            </view>
            <view class="draft-arrow">â€º</view>
          </view>
        </block>
      </block>
      <view wx:else class="empty-state">
        <text class="empty-icon">ğŸ—‚ï¸</text>
        <text class="empty-text">æš‚æ— è‰ç¨¿</text>
      </view>
    </view>

    <view class="card">
      <view class="section-title">äº‘ç«¯ä½œå“</view>
      <block wx:if="{{cloudWorks.length}}">
        <block wx:for="{{cloudWorks}}" wx:key="work_id">
          <view class="cloud-item">
            <view class="cloud-icon">â˜ï¸</view>
            <view class="cloud-info">
              <view class="cloud-name">{{item.work_name || item.work_id}}</view>
              <view class="cloud-type">{{item.scene_type || 'æœªåˆ†ç±»'}} Â· {{item.created_at && item.created_at.slice(0,10)}}</view>
            </view>
          </view>
        </block>
      </block>
      <view wx:else class="empty-state">
        <text class="empty-icon">â˜ï¸</text>
        <text class="empty-text">æš‚æ— äº‘ç«¯ä½œå“</text>
      </view>
    </view>
  </view>
</view>