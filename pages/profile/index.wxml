<view class="container">
  <!-- å¤´éƒ¨ï¼šç”¨æˆ·ä¿¡æ¯ -->
  <view class="profile-header">
    <view class="user-info">
      <view class="user-avatar" bindtap="uploadAvatar">
        <image wx:if="{{profile.avatar_url}}" class="avatar-img" src="{{profile.avatar_url}}" mode="aspectFill" />
        <text wx:else>ğŸ‘¤</text>
        <view class="avatar-overlay">æ›´æ¢å¤´åƒ</view>
      </view>
      <view class="user-details">
        <view class="user-name">{{profile.nickname || profile.name || 'æœªå‘½åç”¨æˆ·'}}</view>
        <view class="user-id">IDï¼š{{profile.id ? profile.id.slice(0,8) : '--'}} Â· {{profile.phone || 'æœªç»‘æ‰‹æœº'}}</view>
        <view class="user-status">
          <text class="status-badge {{profile.member_status ? 'member' : 'free'}}">
            {{profile.member_status ? 'ä¼šå‘˜' : 'å…è´¹ç”¨æˆ·'}}
          </text>
          <text class="security-level">å®‰å…¨ç­‰çº§ï¼š{{profile.security_level}}</text>
        </view>
      </view>
      <button class="edit-btn" size="mini" bindtap="toggleEdit">{{editing ? 'å–æ¶ˆ' : 'ç¼–è¾‘'}}</button>
    </view>
    
    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-num">{{stats.works}}</text>
        <text class="stat-label">ä½œå“</text>
      </view>
      <view class="stat-item">
        <text class="stat-num">{{stats.favorites}}</text>
        <text class="stat-label">æ”¶è—</text>
      </view>
      <view class="stat-item">
        <text class="stat-num">{{stats.drafts}}</text>
        <text class="stat-label">è‰ç¨¿</text>
      </view>
      <view class="stat-item">
        <text class="stat-num">{{stats.templates}}</text>
        <text class="stat-label">æ¨¡æ¿</text>
      </view>
      <view class="stat-item">
        <text class="stat-num">{{stats.downloads}}</text>
        <text class="stat-label">ä¸‹è½½</text>
      </view>
      <view class="stat-item">
        <text class="stat-num">{{stats.views}}</text>
        <text class="stat-label">æµè§ˆ</text>
      </view>
    </view>
  </view>

  <!-- é¡¶éƒ¨å¯é€‰æ  -->
  <view class="tab-bar">
    <view 
      class="tab-item {{activeTab === 'profile' ? 'tab-active' : ''}}" 
      bindtap="switchTab" 
      data-tab="profile"
    >
      <text class="tab-icon">ğŸ‘¤</text>
      <text class="tab-label">ä¸ªäººèµ„æ–™</text>
    </view>
    <view 
      class="tab-item {{activeTab === 'works' ? 'tab-active' : ''}}" 
      bindtap="switchTab" 
      data-tab="works"
    >
      <text class="tab-icon">ğŸ¨</text>
      <text class="tab-label">æˆ‘çš„ä½œå“</text>
    </view>
    <view 
      class="tab-item {{activeTab === 'drafts' ? 'tab-active' : ''}}" 
      bindtap="switchTab" 
      data-tab="drafts"
    >
      <text class="tab-icon">ğŸ“</text>
      <text class="tab-label">è‰ç¨¿ç®±</text>
    </view>
    <view 
      class="tab-item {{activeTab === 'templates' ? 'tab-active' : ''}}" 
      bindtap="switchTab" 
      data-tab="templates"
    >
      <text class="tab-icon">ğŸ“‹</text>
      <text class="tab-label">ä¸ªäººæ¨¡æ¿</text>
    </view>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <view class="content-section">
    <!-- ä¸ªäººèµ„æ–™æ ‡ç­¾é¡µ -->
    <view wx:if="{{activeTab === 'profile'}}">
      <!-- ç¼–è¾‘èµ„æ–™ -->
      <view wx:if="{{editing}}" class="card">
        <view class="section-title">å®Œå–„èµ„æ–™</view>
        <view class="form-item">
          <text class="form-label">å§“å</text>
          <input class="form-input" placeholder="è¯·è¾“å…¥å§“å" value="{{profile.name}}" bindinput="onNameInput" />
        </view>
        <view class="form-item">
          <text class="form-label">æ˜µç§°</text>
          <input class="form-input" placeholder="è¯·è¾“å…¥æ˜µç§°" value="{{profile.nickname}}" bindinput="onNicknameInput" />
        </view>
        <view class="form-item">
          <text class="form-label">ç­¾å</text>
          <input class="form-input" placeholder="è¿™ä¸ªäººå¾ˆæ‡’ï¼Œè¿˜æ²¡æœ‰ç­¾å" value="{{profile.bio}}" bindinput="onBioInput" />
        </view>
        <view class="form-item">
          <text class="form-label">åŸå¸‚</text>
          <input class="form-input" placeholder="åŸå¸‚/åœ°åŒº" value="{{profile.location}}" bindinput="onLocationInput" />
        </view>
        <view class="form-item">
          <text class="form-label">ç½‘ç«™</text>
          <input class="form-input" placeholder="https://example.com" value="{{profile.website}}" bindinput="onWebsiteInput" />
        </view>
        <button class="primary-btn" loading="{{isLoading}}" bindtap="saveProfile">ä¿å­˜èµ„æ–™</button>
      </view>

      <!-- åŠŸèƒ½å¡ç‰‡ -->
      <view class="card">
        <view class="section-title">è´¦æˆ·å®‰å…¨</view>
        <view class="feature-list">
          <view class="feature-item" bindtap="navigateToSecurity">
            <text class="feature-icon">ğŸ”</text>
            <view class="feature-info">
              <text class="feature-title">å¯†ç ä¿®æ”¹</text>
              <text class="feature-desc">å®šæœŸæ›´æ–°å¯†ç ä¿æŠ¤è´¦æˆ·å®‰å…¨</text>
            </view>
            <text class="feature-arrow">â€º</text>
          </view>
          <view class="feature-item" bindtap="navigateToSecurity">
            <text class="feature-icon">ğŸ”’</text>
            <view class="feature-info">
              <text class="feature-title">åŒé‡éªŒè¯</text>
              <text class="feature-desc">å¼€å§‹å¯åéœ€è¦éªŒè¯ç ç™»å½•</text>
            </view>
            <text class="feature-arrow">â€º</text>
          </view>
        </view>
      </view>

      <!-- éšç§è®¾ç½® -->
      <view class="card">
        <view class="section-title">éšç§è®¾ç½®</view>
        <view class="setting-item">
          <text class="setting-label">å…¬å¼€å§‹ä¸ªäººèµ„æ–™</text>
          <switch checked="{{profile.privacy_settings.profile_visible}}" data-setting="profile_visible" bindchange="togglePrivacySetting" />
        </view>
        <view class="setting-item">
          <text class="setting-label">å…¬å¼€å§‹ä½œå“</text>
          <switch checked="{{profile.privacy_settings.works_visible}}" data-setting="works_visible" bindchange="togglePrivacySetting" />
        </view>
        <view class="setting-item">
          <text class="setting-label">æ˜¾ç¤ºåœ¨çº¿çŠ¶æ€</text>
          <switch checked="{{profile.privacy_settings.show_online_status}}" data-setting="show_online_status" bindchange="togglePrivacySetting" />
        </view>
        <button class="secondary-btn" bindtap="savePrivacySettings">ä¿å­˜è®¾ç½®</button>
      </view>

      <!-- æ•°æ®ç»Ÿè®¡ -->
      <view class="card" bindtap="navigateToStatistics">
        <view class="section-title">æ•°æ®ç»Ÿè®¡</view>
        <view class="stats-detail">
          <view class="stat-detail-item">
            <text class="detail-label">ä¼šå‘˜å¤©æ•°</text>
            <text class="detail-value">{{stats.memberDays}} å¤©</text>
          </view>
          <view class="stat-detail-item">
            <text class="detail-label">æ¨¡æ¿ä½¿ç”¨</text>
            <text class="detail-value">{{stats.templates}} æ¬¡</text>
          </view>
          <view class="stat-detail-item">
            <text class="detail-label">ä½œå“ä¸‹è½½</text>
            <text class="detail-value">{{stats.downloads}} æ¬¡</text>
          </view>
        </view>
      </view>

      <!-- æ¶ˆæ¯é€šçŸ¥ -->
      <view class="card" bindtap="navigateToNotifications">
        <view class="section-title">æ¶ˆæ¯é€šçŸ¥</view>
        <view class="notification-preview">
          <text class="notification-count">{{unreadCount}} æ¡æœªè¯»</text>
          <text class="notification-arrow">â€º</text>
        </view>
      </view>
    </view>

    <!-- æˆ‘çš„ä½œå“æ ‡ç­¾é¡µ -->
    <view wx:if="{{activeTab === 'works'}}">
      <view class="card">
        <view class="section-title">ä½œå“ç®¡ç†</view>
        <view class="feature-list">
          <view class="feature-item" bindtap="navigateToWorks">
            <text class="feature-icon">ğŸ¨</text>
            <view class="feature-info">
              <text class="feature-title">æˆ‘çš„ä½œå“</text>
              <text class="feature-desc">æŸ¥çœ‹å’Œç®¡ç†æ‰€æœ‰ä½œå“</text>
            </view>
            <text class="feature-arrow">â€º</text>
          </view>
          <view class="feature-item" bindtap="createNewDraft">
            <text class="feature-icon">â•</text>
            <view class="feature-info">
              <text class="feature-title">æ–°å»ºä½œå“</text>
              <text class="feature-desc">å¼€å§‹å§‹åˆ›ä½œæ–°ä½œå“</text>
            </view>
            <text class="feature-arrow">â€º</text>
          </view>
        </view>
      </view>

      <!-- äº‘ç«¯ä½œå“ -->
      <view class="card">
        <view class="section-title">äº‘ç«¯ä½œå“</view>
        <block wx:if="{{cloudWorks.length}}">
          <block wx:for="{{cloudWorks}}" wx:key="work_id">
            <view class="cloud-item" bindtap="openCloudWork" data-work="{{item}}">
              <view class="cloud-icon">â˜ï¸</view>
              <view class="cloud-info">
                <view class="cloud-name">{{item.work_name || item.work_id}}</view>
                <view class="cloud-type">{{item.scene_type || 'æœªåˆ†äº«ç±»'}} Â· {{item.created_at && item.created_at.slice(0,10)}}</view>
              </view>
            </view>
          </block>
        </block>
        <view wx:else class="empty-state">
          <text class="empty-icon">â˜ï¸</text>
          <text class="empty-text">æš‚æ— äº‘ç«¯ä½œå“</text>
        </view>
      </view>
    </view>

    <!-- è‰ç¨¿ç®±æ ‡ç­¾é¡µ -->
    <view wx:if="{{activeTab === 'drafts'}}">
      <!-- è‰ç¨¿ç®¡ç† -->
      <view class="card">
        <view class="section-title">è‰ç¨¿ç®¡ç†</view>
        <view class="feature-list">
          <view class="feature-item" bindtap="openDraftsPage">
            <text class="feature-icon">ğŸ“</text>
            <view class="feature-info">
              <text class="feature-title">è‰ç¨¿ç®±</text>
              <text class="feature-desc">æŸ¥çœ‹å’Œç®¡ç†æ‰€æœ‰è‰ç¨¿</text>
            </view>
            <text class="feature-arrow">â€º</text>
          </view>
          <view class="feature-item" bindtap="createNewDraft">
            <text class="feature-icon">â•</text>
            <view class="feature-info">
              <text class="feature-title">æ–°å»ºè‰ç¨¿</text>
              <text class="feature-desc">å¼€å§‹å§‹åˆ›ä½œæ–°ä½œå“</text>
            </view>
            <text class="feature-arrow">â€º</text>
          </view>
        </view>
      </view>

      <!-- æˆ‘çš„è‰ç¨¿ -->
      <view class="card">
        <view class="section-title">æˆ‘çš„è‰ç¨¿</view>
        <block wx:if="{{drafts.length}}">
          <block wx:for="{{drafts}}" wx:key="id">
            <view class="draft-item" bindtap="openDraft" bindlongpress="draftActions" data-id="{{item.id}}">
              <view class="draft-info">
                <text class="draft-name">{{item.name || item.id}}</text>
                <text class="draft-size">{{item.size.w}}x{{item.size.h}}</text>
              </view>
              <view class="draft-arrow">â€º</view>
            </view>
          </block>
        </block>
        <view wx:else class="empty-state">
          <text class="empty-icon">ğŸ“</text>
          <text class="empty-text">æš‚æ— è‰ç¨¿</text>
        </view>
      </view>
    </view>

    <!-- ä¸ªäººæ¨¡æ¿æ ‡ç­¾é¡µ -->
    <view wx:if="{{activeTab === 'templates'}}">
      <view class="card">
        <view class="section-title">æ¨¡æ¿ç®¡ç†</view>
        <view class="feature-list">
          <view class="feature-item" bindtap="navigateToTemplates">
            <text class="feature-icon">ğŸ“‹</text>
            <view class="feature-info">
              <text class="feature-title">æˆ‘çš„æ¨¡æ¿</text>
              <text class="feature-desc">æŸ¥çœ‹å’Œç®¡ç†ä¸ªäººæ¨¡æ¿</text>
            </view>
            <text class="feature-arrow">â€º</text>
          </view>
          <view class="feature-item" bindtap="createNewTemplate">
            <text class="feature-icon">â•</text>
            <view class="feature-info">
              <text class="feature-title">æ–°å»ºæ¨¡æ¿</text>
              <text class="feature-desc">åˆ›å»ºè‡ªå®šä¹‰æ¨¡æ¿</text>
            </view>
            <text class="feature-arrow">â€º</text>
          </view>
        </view>
      </view>

      <view class="card">
        <view class="section-title">æ¨¡æ¿ç»Ÿè®¡</view>
        <view class="stats-detail">
          <view class="stat-detail-item">
            <text class="detail-label">æ¨¡æ¿æ•°é‡</text>
            <text class="detail-value">{{stats.templates}} ä¸ª</text>
          </view>
          <view class="stat-detail-item">
            <text class="detail-label">ä½¿ç”¨æ¬¡æ•°</text>
            <text class="detail-value">{{stats.templateUses || 0}} æ¬¡</text>
          </view>
          <view class="stat-detail-item">
            <text class="detail-label">æ”¶è—äººæ•°</text>
            <text class="detail-value">{{stats.templateFavorites || 0}} äºº</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ ‡ç­¾é¡µç»“æŸæ ‡ç­¾ -->
  <view wx:if="{{activeTab === 'profile'}}"></view>
  <view wx:if="{{activeTab === 'works'}}"></view>
  <view wx:if="{{activeTab === 'drafts'}}"></view>
  <view wx:if="{{activeTab === 'templates'}}"></view>
</view>