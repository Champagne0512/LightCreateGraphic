<!-- è‰ç¨¿ç®¡ç†é¡µé¢ - ç°ä»£åŒ–è®¾è®¡é£æ ¼ -->
<view class="drafts-container">
  
  <!-- é¡¶éƒ¨æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-box">
      <input 
        class="search-input" 
        placeholder="æœç´¢è‰ç¨¿..." 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        confirm-type="search"
      />
      <view class="search-icon">ğŸ”</view>
      <view wx:if="{{searchKeyword}}" class="clear-btn" bindtap="clearSearch">
        <text>Ã—</text>
      </view>
    </view>
    
    <!-- ç­›é€‰å’Œæ’åº -->
    <view class="filter-sort-bar">
      <!-- ç­›é€‰æŒ‰é’®ç»„ -->
      <view class="filter-group">
        <view 
          class="filter-btn {{filter === 'all' ? 'active' : ''}}"
          data-filter="all"
          bindtap="onFilterChange"
        >
          å…¨éƒ¨
        </view>
        <view 
          class="filter-btn {{filter === 'local' ? 'active' : ''}}"
          data-filter="local"
          bindtap="onFilterChange"
        >
          æœ¬åœ°
        </view>
        <view 
          class="filter-btn {{filter === 'cloud' ? 'active' : ''}}"
          data-filter="cloud"
          bindtap="onFilterChange"
        >
          äº‘ç«¯
        </view>
      </view>
      
      <!-- æ’åºæŒ‰é’® -->
      <view class="sort-btn" bindtap="showSortMenu">
        <text>{{getSortText()}}</text>
        <text class="sort-arrow">â–¼</text>
      </view>
    </view>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <view class="content-area">
    
    <!-- ç¼–è¾‘æ¨¡å¼å·¥å…·æ  -->
    <view wx:if="{{editMode}}" class="edit-toolbar">
      <view class="selected-count">
        å·²é€‰æ‹© {{selectedDrafts.length}} ä¸ªè‰ç¨¿
      </view>
      <view class="edit-actions">
        <view class="edit-btn delete" bindtap="batchDelete">
          <text>åˆ é™¤</text>
        </view>
        <view class="edit-btn upload" bindtap="batchUploadToCloud">
          <text>ä¸Šä¼ åˆ°äº‘ç«¯</text>
        </view>
        <view class="edit-btn cancel" bindtap="toggleEditMode">
          <text>å–æ¶ˆ</text>
        </view>
      </view>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="loading-state">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:elif="{{isEmpty}}" class="empty-state">
      <view class="empty-icon">ğŸ“</view>
      <text class="empty-title">æš‚æ— è‰ç¨¿</text>
      <text class="empty-desc">å¼€å§‹åˆ›ä½œç¬¬ä¸€ä¸ªä½œå“å§</text>
      <view class="empty-action" bindtap="goToEditor">
        <text>æ–°å»ºè‰ç¨¿</text>
      </view>
    </view>

    <!-- è‰ç¨¿åˆ—è¡¨ -->
    <view wx:else class="drafts-grid">
      <block wx:for="{{drafts}}" wx:key="id">
        <view 
          class="draft-card {{selectedDrafts.indexOf(item.id) > -1 ? 'selected' : ''}}"
          bindtap="{{editMode ? 'toggleSelectDraft' : 'openDraft'}}"
          bindlongpress="onDraftLongPress"
          data-id="{{item.id}}"
        >
          
          <!-- é€‰æ‹©æ¡† -->
          <view wx:if="{{editMode}}" class="select-checkbox">
            <view class="checkbox {{selectedDrafts.indexOf(item.id) > -1 ? 'checked' : ''}}">
              <text wx:if="{{selectedDrafts.indexOf(item.id) > -1}}">âœ“</text>
            </view>
          </view>
          
          <!-- è‰ç¨¿ç¼©ç•¥å›¾ -->
          <view class="draft-thumbnail">
            <view class="thumbnail-content">
              <text class="draft-icon">{{getDraftIcon(item)}}</text>
            </view>
            
            <!-- äº‘ç«¯æ ‡è¯† -->
            <view wx:if="{{item.source === 'cloud'}}" class="cloud-badge">
              <text>â˜ï¸</text>
            </view>
            
            <!-- è‰ç¨¿çŠ¶æ€ -->
            <view class="draft-status">
              <text class="status-badge {{getStatusClass(item)}}">
                {{getStatusText(item)}}
              </text>
            </view>
          </view>

          <!-- è‰ç¨¿ä¿¡æ¯ -->
          <view class="draft-info">
            <view class="draft-name">{{item.name || item.id}}</view>
            <view class="draft-meta">
              <text class="meta-item">{{formatTime(item.updatedAt || item.modifiedAt)}}</text>
              <text wx:if="{{item.size}}" class="meta-item">{{formatSize(item.size)}}</text>
            </view>
            <view wx:if="{{item.note}}" class="draft-note">{{item.note}}</view>
          </view>

          <!-- æ“ä½œæŒ‰é’® -->
          <view wx:if="{{!editMode}}" class="draft-actions">
            <view class="action-btn more" bindtap="showActionMenu" data-id="{{item.id}}">
              <text>â‹®</text>
            </view>
          </view>
        </view>
      </block>
    </view>
  </view>

  <!-- åº•éƒ¨å·¥å…·æ  -->
  <view class="bottom-toolbar">
    <view class="toolbar-content">
      <view class="toolbar-left">
        <view class="stats-info">
          <text>å…± {{drafts.length}} ä¸ªè‰ç¨¿</text>
        </view>
      </view>
      
      <view class="toolbar-right">
        <view class="toolbar-btn edit-mode" bindtap="toggleEditMode">
          <text>{{editMode ? 'å®Œæˆ' : 'é€‰æ‹©'}}</text>
        </view>
        <view class="toolbar-btn new-draft" bindtap="goToEditor">
          <text>æ–°å»º</text>
        </view>
      </view>
    </view>
  </view>

</view>

<!-- æ’åºèœå• -->
<view wx:if="{{showSortMenu}}" class="sort-menu-overlay" bindtap="hideSortMenu">
  <view class="sort-menu" catchtap="">
    <view class="menu-header">
      <text>æ’åºæ–¹å¼</text>
    </view>
    <view class="menu-options">
      <view 
        class="menu-item {{sortBy === 'modified' && sortOrder === 'desc' ? 'active' : ''}}"
        data-sort-by="modified"
        data-sort-order="desc"
        bindtap="onSortChange"
      >
        <text>æœ€è¿‘ä¿®æ”¹ â†“</text>
      </view>
      <view 
        class="menu-item {{sortBy === 'modified' && sortOrder === 'asc' ? 'active' : ''}}"
        data-sort-by="modified"
        data-sort-order="asc"
        bindtap="onSortChange"
      >
        <text>æœ€è¿‘ä¿®æ”¹ â†‘</text>
      </view>
      <view 
        class="menu-item {{sortBy === 'name' ? 'active' : ''}}"
        data-sort-by="name"
        data-sort-order="asc"
        bindtap="onSortChange"
      >
        <text>åç§°æ’åº</text>
      </view>
      <view 
        class="menu-item {{sortBy === 'created' ? 'active' : ''}}"
        data-sort-by="created"
        data-sort-order="desc"
        bindtap="onSortChange"
      >
        <text>åˆ›å»ºæ—¶é—´</text>
      </view>
      <view 
        class="menu-item {{sortBy === 'size' ? 'active' : ''}}"
        data-sort-by="size"
        data-sort-order="desc"
        bindtap="onSortChange"
      >
        <text>æ–‡ä»¶å¤§å°</text>
      </view>
    </view>
  </view>
</view>