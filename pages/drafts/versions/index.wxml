<!-- 版本历史页面 -->
<view class="versions-container">
  
  <!-- 页面头部 -->
  <view class="page-header">
    <view class="header-content">
      <view class="back-btn" bindtap="goBack">
        <text>←</text>
      </view>
      <view class="header-title">
        <text class="title-main">{{draftName}}</text>
        <text class="title-sub">版本历史</text>
      </view>
    </view>
    
    <!-- 当前版本信息 -->
    <view wx:if="{{currentVersion}}" class="current-version">
      <view class="version-badge current">
        <text>当前版本</text>
      </view>
      <view class="version-info">
        <text class="version-time">{{formatTime(currentVersion.timestamp)}}</text>
        <text class="version-size">{{formatSize(currentVersion.size || 0)}}</text>
      </view>
    </view>
  </view>

  <!-- 内容区域 -->
  <view class="content-area">
    
    <!-- 加载状态 -->
    <view wx:if="{{loading}}" class="loading-state">
      <view class="loading-spinner"></view>
      <text class="loading-text">加载版本历史中...</text>
    </view>

    <!-- 空状态 -->
    <view wx:elif="{{versions.length === 0}}" class="empty-state">
      <view class="empty-icon">⏱️</view>
      <text class="empty-title">暂无版本历史</text>
      <text class="empty-desc">每次保存都会创建一个新版本</text>
    </view>

    <!-- 版本列表 -->
    <view wx:else class="versions-list">
      <block wx:for="{{versions}}" wx:key="timestamp" wx:for-index="index">
        <view class="version-item {{index === 0 ? 'current' : ''}}">
          
          <!-- 时间线 -->
          <view class="timeline">
            <view class="timeline-dot"></view>
            <view wx:if="{{index !== versions.length - 1}}" class="timeline-line"></view>
          </view>

          <!-- 版本内容 -->
          <view class="version-content">
            
            <!-- 版本头信息 -->
            <view class="version-header">
              <view class="version-meta">
                <text class="version-number">版本 {{item.no}}</text>
                <text class="version-time">{{formatTime(item.ts || item.timestamp)}}</text>
              </view>
              
              <!-- 云端标识 -->
              <view wx:if="{{item.source === 'cloud'}}" class="cloud-tag">
                <text>☁️</text>
              </view>
            </view>

            <!-- 版本详情 -->
            <view class="version-details">
              <view class="detail-row">
                <text class="detail-label">大小:</text>
                <text class="detail-value">{{formatSize(item.size || 0)}}</text>
              </view>
              
              <view wx:if="{{item.note}}" class="detail-row">
                <text class="detail-label">备注:</text>
                <text class="detail-value note">{{item.note}}</text>
              </view>
              
              <view class="detail-row">
                <text class="detail-label">来源:</text>
                <text class="detail-value">{{item.source === 'local' ? '本地' : '云端'}}</text>
              </view>
            </view>

            <!-- 操作按钮 -->
            <view class="version-actions">
              <view 
                class="action-btn view" 
                bindtap="viewVersion" 
                data-index="{{index}}"
              >
                <text>查看详情</text>
              </view>
              
              <view 
                wx:if="{{index !== 0}}" 
                class="action-btn restore" 
                bindtap="restoreVersion" 
                data-index="{{index}}"
              >
                <text>恢复到此版本</text>
              </view>
              
              <view 
                class="action-btn download" 
                bindtap="downloadVersion" 
                data-index="{{index}}"
              >
                <text>下载</text>
              </view>
            </view>
          </view>
        </view>
      </block>
    </view>
  </view>

  <!-- 底部信息 -->
  <view class="footer-info">
    <text class="footer-text">共 {{versions.length}} 个版本记录</text>
  </view>

</view>